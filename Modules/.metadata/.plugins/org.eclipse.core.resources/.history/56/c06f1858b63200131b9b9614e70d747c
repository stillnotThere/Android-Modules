/**
 * @author Rohan K.M rohan.mahendroo@gmail.com
 * DataStateListener
 * com.acropolis.module.data
 * DataStateListener.java
 * Created - 2013-10-11 1:55:59 PM	
 * Modified - 2013-10-11 1:55:59 PM
 * TODO
 * NOTES - 
 */
package com.app.project.acropolis;

import android.content.ContentValues;
import android.net.TrafficStats;
import android.telephony.PhoneStateListener;
import android.telephony.TelephonyManager;

import com.app.project.acropolis.database.DBAdapter;
import com.app.project.acropolis.database.DBOpenHelper;

/**
 * @author CPH-iMac
 *
 */
public class DataMonitoring extends PhoneStateListener 
{

	long downloaded = 0;
	long uploaded = 0;
	
	public void onDataActivity(int direction)
	{
		DBAdapter dbAdapter = new DBAdapter(MainActivity.getContext());
		switch(direction)
		{
		case TelephonyManager.DATA_ACTIVITY_IN:
			downloaded = TrafficStats.getMobileRxBytes();
			Logger.Debug("DATA IN\nbytes::"+downloaded);
		
		case TelephonyManager.DATA_ACTIVITY_OUT:
			uploaded = TrafficStats.getMobileTxBytes();
			Logger.Debug("DATA OUT\nbytes::"+uploaded);
			
		case TelephonyManager.DATA_ACTIVITY_INOUT:
			downloaded = TrafficStats.getMobileRxBytes();
			uploaded = TrafficStats.getMobileTxBytes();
			Logger.Debug("DATA INOUT\nbytes::"+(downloaded + uploaded));
		}
		
		if(!dbAdapter.isEmpty())
		{
			long previous = Long.parseLong(dbAdapter.getValue(DBOpenHelper.INCOMING));
			long newV = convert(Long.parseLong(lastCallduration));
			long total = previous + newV;
			
			ContentValues cv = new ContentValues();
			cv.put(DBOpenHelper.INCOMING, String.valueOf(total));
			dbAdapter.update(cv);
		}
		else
		{
			ContentValues cv = new ContentValues();
			cv.put(DBOpenHelper.INCOMING, String.valueOf(
					convert(Long.parseLong(lastCallduration))));
			dbAdapter.update(cv);
		}
		
		Logger.Debug(
				"Downloaded:::"+downloaded +
				"\nUploaded:::"+uploaded);
	}
	
}
