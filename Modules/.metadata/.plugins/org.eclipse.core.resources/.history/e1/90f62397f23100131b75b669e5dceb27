/**
 * @author Rohan K.M rohan.mahendroo@gmail.com
 * CallStateListener
 * com.acropolis.module.call
 * CallStateListener.java
 * Created - 2013-10-10 3:48:50 PM	
 * Modified - 2013-10-10 3:48:50 PM
 * TODO
 * NOTES - 
 */
package com.acropolis.module.call;

import android.telephony.PhoneStateListener;
import android.telephony.TelephonyManager;

/**
 * @author CPH-iMac
 *
 */
public class CallStateListener extends PhoneStateListener
{

	boolean numberPresent = false;
	boolean incoming = false;
	boolean missed = false;

	boolean ringing = false;
	boolean offhook = false;
	boolean idle = false;

	public void onCallStateChanged(int state,String incomingNumber)
	{
		String strState = "";
		int i=0,j=0,k=0;

		switch(state)
		{
		case TelephonyManager.CALL_STATE_IDLE:
			strState = "IDLE";
			++i;
			Logger.Debug("number:::"+incomingNumber + "\nstate::"+strState + "\ncount:"+i);	

			if(ringing)
			{
				incoming = false;
				missed = true;
				strState = "missed";
			}
			
			
//			if(incomingNumber!=null)
//			{
//				if(ringing)
//				{
//					idle = true;
//					incoming = true;
//					if(idle)
//					{
//						if(!incoming)
//						{
//							missed = true;
//							Logger.Debug("Missed call");
//						}
//						else
//							missed = false;
//
//						//flushing
//						idle = false;
//					}
//				}
//				//flushing
//				incoming = false;
//				ringing = false;
//			}


		case TelephonyManager.CALL_STATE_OFFHOOK:
			strState = "OFF HOOK";
			++j;
			Logger.Debug("number:::"+incomingNumber + "\nstate::"+strState + "\ncount:"+i);

			if(ringing)
			{
				incoming = true;
				strState = incoming;
			}
			
//			if(incomingNumber!=null)
//			{
//				if(ringing)
//				{
//					offhook = true;
//					if(offhook)
//					{
//						incoming = true;
//						Logger.Debug("Incoming call");
//
//						//flushing
//						offhook = false;
//					}
//					//flushing
//					ringing = false;
//				}		
//			}


		case TelephonyManager.CALL_STATE_RINGING:
			strState = "RINGING";
			++k;
			Logger.Debug("number:::"+incomingNumber + "\nstate::"+strState + "\ncount:"+k);

			if(incomingNumber!=null)
			{
				ringing = true;
			}

		}

//		incoming = false;
//		missed = false;

		Logger.Debug("");

	}

}
