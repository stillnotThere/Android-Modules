/**
 * @author Rohan K.M rohan.mahendroo@gmail.com
 * MessageAT
 * com.acropolis.module.messagemodule
 * MessageAT.java
 * Created - 2013-10-02 2:56:36 PM	
 * Modified - 2013-10-02 2:56:36 PM
 * TODO
 * NOTES - 
 */
package com.acropolis.module.message;

import android.app.Service;
import android.content.ContentResolver;
import android.content.Context;
import android.content.Intent;
import android.database.ContentObserver;
import android.database.Cursor;
import android.net.Uri;
import android.os.IBinder;

/**
 * @author CPH-iMac
 *
 */
public class OutgoingMessagingService extends Service
{
	Context appContext = MainActivity.getAppContext();
	Cursor smsSentCursor = null;
	final Uri outgoingMessageUri = Uri.parse("content://sms/out/");
	final static String[] projections = {"date","address","body"};
	int sentcounter = 0;
	//date(milli) phonenumber messagebody
	final static String selection = null;	//row (WHERE clause)
	final static String[] selectionArgs = null;	//conditions
	final static String sortOrder = null;	//sorting (default last msg first)
	
	/* (non-Javadoc)
	 * @see android.app.Service#onBind(android.content.Intent)
	 */
	@Override
	public IBinder onBind(Intent intent) {
		ContentResolver outgoingMessageCR = 
				appContext.getContentResolver();
		outgoingMessageCR.registerContentObserver(
				outgoingMessageUri, true,
				new OutgoingMessageContentObserver());
		return null;
	}

	public class OutgoingMessageContentObserver extends ContentObserver
	{
		public OutgoingMessageContentObserver() {super(null);}

		public void onChange(boolean selfChange)
		{
			super.onChange(selfChange);
			int dbsent = 0;
			int storetotal = 0;

			smsSentCursor = appContext.getContentResolver().query(
					outgoingMessageUri, projections, selection, 
					selectionArgs, sortOrder);
			smsSentCursor.moveToFirst();	//last message received
//			smsSentTo = smsSentCursor.
//					getString(smsSentCursor.getColumnIndex("address"));
//			smsSentText = smsSentCursor.
//					getString(smsSentCursor.getColumnIndex("body"));
			sentcounter++;
			Logger.Debug("sentcounter::::"+sentcounter);
		}

	}
}
