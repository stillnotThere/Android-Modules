/**
 * @author Rohan K.M rohan.mahendroo@gmail.com
 * CallStateListener
 * com.acropolis.module.call
 * CallStateListener.java
 * Created - 2013-10-10 3:48:50 PM	
 * Modified - 2013-10-10 3:48:50 PM
 * TODO
 * NOTES - 
 */
package com.acropolis.module.call;

import android.database.Cursor;
import android.net.Uri;
import android.provider.CallLog;
import android.telephony.PhoneStateListener;
import android.telephony.TelephonyManager;

/**
 * @author CPH-iMac
 *
 */
public class IncomingCallListener extends PhoneStateListener
{

	boolean numberPresent = false;
	boolean incoming = false;
	boolean missed = false;

	boolean ringing = false;
	boolean offhook = false;
	boolean idle = false;

	public void onCallStateChanged(int state,String incomingNumber)
	{

		switch(state)
		{
		case TelephonyManager.CALL_STATE_IDLE:
			ringing = false;
			offhook = false;
			if(incoming)
			{
				Uri contentUri = CallLog.Calls.CONTENT_URI;
				Cursor cursor = MainActivity.getContext().
						getContentResolver().
						query(contentUri, new String[]{"*"}, null, null, null);
				
				if(cursor.moveToFirst())
				{
					
				}
				
			}
			

		case TelephonyManager.CALL_STATE_OFFHOOK:

			if(incomingNumber!=null)
			{
				if(ringing)
				{
					offhook = true;
					if(offhook)
					{
						incoming = true;
						Logger.Debug("Incoming call");

						//flushing
						offhook = false;
					}
					//flushing
					ringing = false;
				}		
			}


		case TelephonyManager.CALL_STATE_RINGING:

			if(incomingNumber!=null)
			{
				ringing = true;
			}

		}

		incoming = false;

	}

}
